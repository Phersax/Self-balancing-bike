/*
 * kalman_fns.c
 *
 *  Created on: Sep 9, 2024
 *      Author: Francesco Stasi :>
 */
#include <math.h>
#include "filter.h"

/* struct {
  float pitch;
  float roll;
  float yaw;
} Orientation; */

extern Orientation or;

void updateOrientation(float accX, float accY, float accZ, float gyroX, float gyroY, float gyroZ)
{

  // compute pitch and roll from acc
  float pitchAcc = atan2(-accX, sqrt(accY * accY + accZ * accZ)) * 180 / M_PI;
  float rollAcc = atan2(accY, accZ) * 180 / M_PI;
 
  // include complementary filter
  or -> pitch = alpha * (or -> pitch + gyroX * dt) + (1 - alpha) * pitchAcc;
  or -> roll = alpha * (or -> roll + gyroY * dt) + (1 - alpha) * rollAcc;
  or -> yaw += gyroZ * dt;

}

float getPitch() {
  return or -> pitch;
}

float getRoll() {
  return or -> roll;
}

float getYaw() {
  return or -> yaw;
}
