/*
 * kalman_fns.c
 *
 *  Created on: Sep 9, 2024
 *      Author: dannato Francesco Stasi
 */
#include <math.h>
#include "filter.h"

Orientation or;

void updateOrientation(float accX, float accY, float accZ, float gyroX, float gyroY, float gyroZ) 
{

  // compute pitch and roll from acc
  float pitchAcc = atan2(accX, sqrt(accY * accY + accZ * accZ)) * 180 / M_PI;
  float rollAcc = atan2(accY, sqrt(accX * accX + accZ * accZ)) * 180 / M_PI;
 
  // include complementary filter
  or.pitch = alpha * (or.pitch + gyroX * dt) + (1 - alpha) * pitchAcc;
  or.roll = alpha * (or.roll + gyroY * dt) + (1 - alpha) * rollAcc;

  or.yaw += gyroZ * dt;
  if (or.yaw < 0) or.yaw += 360;
  else if (or.yaw > 359) or.yaw -= 360;

}

float getPitch() {
  return or.pitch;
}
float getRoll() {
  return or.roll;
}

float getYaw() {
  return or.yaw;
}